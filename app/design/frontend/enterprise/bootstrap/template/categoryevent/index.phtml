<?php
/**
 * Harapartners
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Harapartners License
 * that is bundled with this package in the file LICENSE_EE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://www.Harapartners.com/license
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@Harapartners.com so we can send you a copy immediately.
 *
 */
?>

<?php
/**
 * Catalog index list template
 * Load Top, Live, Upcoming events
 * 
 */
?>
<?php 
    $indexDataObj 	= 	$this->getIndexDataObject();
    $baseUrl 		= 	Mage::getBaseUrl();
    $maxPerSend 	= 	0;
    $timer 			= 	0;
    $topArray 		= 	'';
    $liveArray 		= 	'';
    $upcomingArray  = 	'';	
    if( $indexDataObj->hasData('toplive') ){
        $topArray = $indexDataObj->getData('toplive');
        $topArray = array(); //Harapartners, yang: temploary block the top events
    }
    if( $indexDataObj->hasData('live') ){
        $liveArray = $indexDataObj->getData('live');
    }
    if( $indexDataObj->hasData('upcoming') ){
        $upcomingArray = $indexDataObj->getData('upcoming');
    }
?>
<?php echo $this->getLayout()->createBlock('cms/block')->setBlockId('home_banner')->toHtml();?>

<section id="pageheader" class="jumbotron subhead">
  <div class="page-header subnav">
    <h2><img src="/skin/frontend/enterprise/bootstrap/images/iconmonstr-time-8-icon.png" width="50px" style="margin-right:5px;" /> Today's Sales</h2>
  </div>
</section>

<div class="catalog-events-container">
    <div class="live-events-container">
        <div class="top-events">
<?php foreach ($topArray as $top):?>
        <?php
            $endcountRaw = strtotime($top['event_end_date']);
            $endcount = date("F j, Y, G:i:s", $endcountRaw);
        ?>
        <div class="catalog-top-event event-counter-<?php echo $timer;?>">
        <?php $imgFile = BP.DS.'media'.DS.'catalog'.DS.'category'.DS.$top['small_image'];?>
        <a class="event-link" href="<?php echo Mage::getBaseUrl().$top['url_path']; ?>"><img src="<?php echo Mage::helper('service/image')->loadImageFile($imgFile)->resize(208,403); ?>" width="208px" alt="" /></a>
        <div class="splash-details">
        <div class="table-cell-left">
        <p class="event-name ellipsis"><?php echo $top['name'];?></p>
        <p id="time1-top-<?php echo $timer ?>"></p>
        <script type="text/javascript">
        jQuery("#time1-top-<?php echo $timer ?>").countdown({
        //date: "12 10, 2011 16:11", //Counting TO a date
        date: "<?php echo $endcount; ?>", //Counting TO a date
        htmlTemplate: "<span>Ends in</span> %{d} <span class=\"cd-time\">Days</span> %{h}<span class=\"cd-time\">:</span>%{m}<span class=\"cd-time\">:</span>%{s}<span class=\"cd-time\"></span>",
        onChange: function( event, timer ){
        },
        onComplete: function( event ){
        jQuery(this).html("Completed");
        jQuery("div.event-counter-<?php echo $timer;?>").remove();
        },
        leadingZero: true,
        direction: "down"
        });
        </script>
        </div>
    </div>
</div>
<?php $timer++;?>
<?php endforeach;?>
<ul class="thumbnails">
<?php foreach ($liveArray as $live):?>
    <?php
        $endcountRaw = strtotime($live['event_end_date']);
        $endcount = date("F j, Y, G:i:s", $endcountRaw);
        $hasProduct = $this->hasProduct($live['entity_id']);
    ?>
    <?php if ($hasProduct):?>
    <div class="catalog-event event-counter-<?php echo $timer;?>">
        <span class="echoShare" 
        data-productname="<?php echo $live['name'];?>" 
        data-productcap="" 
        data-productdesc="<?php echo 
        strip_tags(html_entity_decode($this->getDescription($live['description'])));?>" 
        data-imageclass="" 
        data-producturl="<?php echo Mage::getBaseUrl().$live['url_path']; ?>">
        </span>
    </div>
    <li class="span3">
    <div class="thumbnail" style="margin:0px; padding:0px;">
    <h5 class="ellipsis" style="font-size:14px; padding:5px 5px 0px 5px;"><?php echo $live['name'];?></h5>
    <p id="time1-<?php echo $timer ?>" style="color:#808080; font-size:12px; padding:0px 5px;"></p>
    <?php
                    $imgFile = (isset($live['small_image']))
                        ? BP . DS . 'media' . DS . 'catalog' . DS . 'category' . DS . $live['small_image']
                        : BP . DS . 'skin' . DS . 'frontend' . DS . 'enterprise ' . DS . 'harapartners' . DS . 'images' . DS . 'catalog' . DS . 'product' . DS . 'placeholder' . DS . 'small_image.jpg';
                    ?>
    <a class="event-link" href="<?php echo Mage::getBaseUrl().$live['url_path']; ?>"><img src="<?php echo Mage::helper('service/image')->loadImageFile($imgFile)->resize(230)->keepFrame(FALSE); ?>" width="230px" alt="" /></a>
    <script type="text/javascript">
    var html = getTimerHtml('live','<?php echo $endcount ?>');
    jQuery("#time1-<?php echo $timer ?>").countdown({//date: "12 10, 2011 16:11", //Counting TO a date
    date: "<?php echo $endcount; ?>", //Counting TO a date
    htmlTemplate: html,
    onComplete: function( event ){
    jQuery(this).html("Completed");
    jQuery("div.event-counter-<?php echo $timer;?>").remove();
    },
    leadingZero: true,
    direction: "down"
    });
    </script>
<?php $timer++;?>
</div>
</li>
<?php endif;?>
<?php endforeach;?>
</ul>
</div>
<?php if (!!$upcomingArray && !empty($upcomingArray)):?>
<div class="page-header">
    <h2><img src="/skin/frontend/enterprise/bootstrap/images/iconmonstr-calendar-5-icon.png" width="50px" style="margin-right:5px;" class="pull-left" /> Upcoming Sales</h2>
</div>
    <div class="upcoming-events-container">
        <ul class="thumbnails">
        <?php foreach ($upcomingArray as $up):?>
        <?php
            $endcountRaw = strtotime($up['event_start_date']);
            $endcount = date("F j, Y, G:i:s", $endcountRaw);
        ?>
        <div class="catalog-event up-event-counter-<?php echo $timer;?>">
            <span class="echoShare" 
                data-productname="<?php echo $up['name'];?>" 
                data-productcap="" 
                data-productdesc="<?php echo strip_tags(html_entity_decode($this->getDescription($up['description'])));?>" 
                data-imageclass="" 
                data-producturl="<?php echo Mage::getBaseUrl().$up['url_path']; ?>">
            </span>
        </div>
        <li class="span2">
            <div class="thumbnail">
            <h5 class="ellipsis"><?php echo $up['name'];?></h5>
            <p id="time1-<?php echo $timer ?>"></p>
            <?php
                $imgFile = (isset($up['small_image']))
                ? BP . DS . 'media' . DS . 'catalog' . DS . 'category' . DS .
                $up['small_image']
                : BP . DS . 'skin' . DS . 'frontend' . DS . 'enterprise ' . DS . 'harapartners' . DS . 'images' . DS . 'catalog' . DS . 'product' . DS . 'placeholder' . DS . 'small_image.jpg';
            ?>
            <a class="event-link" href="<?php echo Mage::getBaseUrl().$up['url_path']; ?>"><img src="<?php echo Mage::helper('service/image')->loadImageFile($imgFile)->resize(165); ?>" width="165px" alt="" /></a>
            <script type="text/javascript">
            var html = getTimerHtml('upcoming','<?php echo $endcount ?>');
            jQuery("#time2-<?php echo $timer ?>").countdown({
            //date: "12 10, 2011 16:11", //Counting TO a date
            date: "<?php echo $endcount; ?>", //Counting TO a date
            htmlTemplate: html,
            onComplete: function( event ){
            jQuery(this).html("Completed");
            jQuery("div.up-event-counter-<?php echo $timer;?>").remove();
            },
            leadingZero: true,
            direction: "down"
            });
            </script>
            <?php $timer++;?>
            </div>
        </li>
<?php endforeach;?>
        </ul>
        </div>
    <?php endif;?>	
    </div>
    <!-- div class="page-header">
        <h2><img src="/skin/frontend/enterprise/bootstrap/images/iconmonstr-time-8-icon.png" width="50px" style="margin-right:5px;" /> Hurry, Ending Soon!</h2>
    </div -->
</div>